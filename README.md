# FastAPI: Система бронирования отелей

## Проект системы бронирования отелей с использованием библиотеки FastAPI

Разработан в рамках обучающего курса:  
[Артём Шумейко — backend разработка](https://artemshumeiko.zenclass.ru/public/products)

![Логотип FastAPI](https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png)

---

## Содержание проекта

- [1. Настройка проекта](/course_helpers/2%20Осваиваем%20FastAPI/FastApi.md)
- [2. Установка и настройка БД — PostgreSQL](/course_helpers/3%20База%20данных%20и%20паттерны/PostgreSQL.md)
- [3. Миграции с Alembic](/course_helpers/3%20База%20данных%20и%20паттерны/Alembic.md)
- [4. Интеграция Celery](/course_helpers/6%20Кэширование%20с%20Redis/Celery.md)
- [5. Установка и настройка Redis](/course_helpers/6%20Кэширование%20с%20Redis/Redis.md)
- [6. Тестирование](/course_helpers/7%20Тестирование/Testing.md)
- [7. Работа с Docker](/course_helpers/9%20Docker%20и%20деплой%20проекта/Docker.md)

## Содержание не связанное с проектом

- [8. Запуск Swagger-документации и сервера для локальной сети](/course_helpers/9%20Docker%20и%20деплой%20проекта/Localhost.md)
- [9. Подключение по SSH с компьютера к ноутбуку по локальной сети](/course_helpers/9%20Docker%20и%20деплой%20проекта/ssh.md)

---

## Схема базы данных и описание сущностей

### ER-диаграмма базы данных

![ER-диаграмма базы данных](/course_helpers/alembic_version_2.png)

**Пояснения к ER-диаграмме:**

- Таблица `users` связана с `bookings` по полю пользователя (один ко многим).
- `hotels` содержит множество `rooms` (один ко многим).
- `rooms` связана с `facilities` через таблицу связи `rooms_facilities` (многие ко многим).
- `bookings` связывает пользователя и комнату с указанием дат и стоимости.

---

### Описание таблиц

#### 1. `users` — Пользователи

Хранит данные зарегистрированных пользователей: id, email, хэш пароля и др.  
Связь: пользователь может иметь множество бронирований.

#### 2. `hotels` — Отели

Содержит информацию об отелях: id, название, местоположение.  
Связь: отель содержит множество комнат.

#### 3. `rooms` — Комнаты

Описание комнат в отелях: id, ссылка на отель, название, описание, цена, количество мест.  
Связи: принадлежит отелю, связана с удобствами и бронированиями.

#### 4. `facilities` — Удобства

Список удобств (Wi-Fi, кондиционер и т.п.): id, наименование.  
Связь: связаны с комнатами через таблицу `rooms_facilities`.

#### 5. `rooms_facilities` — Связь комнат и удобств

Таблица связи многие-ко-многим: id, ссылки на комнату и удобство.

#### 6. `bookings` — Бронирования

Информация о бронированиях: id, ссылки на пользователя и комнату, даты бронирования, стоимость, статус бронирования и
статус оплаты.

#### 7. `alembic_version` — Управление миграциями

Хранит информацию о текущей версии миграции базы данных.

---

## Бизнес-процесс бронирования

### BPMN схема

![BPMN-схема бизнес-процесса](/course_helpers/BPMN.png)

**Пояснения к BPMN-схеме:**

- Участники: клиент (пользователь), система бронирования (FastAPI), база данных (PostgreSQL), сотрудник отеля (
  опционально).
- Основные процессы включают поиск, выбор, регистрацию, бронирование, оплату и подтверждение.

### Основные шаги

1. Клиент ищет доступные номера по дате и удобствам.
2. Система возвращает список доступных комнат, соответствующих критериям поиска.
3. Клиент выбирает комнату и регистрируется/авторизуется.
4. Клиент подтверждает бронирование с указанием дат.
5. Система создает запись бронирования с начальным статусом (например, "ожидает оплаты").
6. Клиент оплачивает бронирование (опционально).
7. Система обновляет статус бронирования и уведомляет клиента и отель.
8. Клиент заселяется в выбранные даты.

---

## Связь шагов с сущностями базы данных

| Шаг | Описание действия                   | Задействованные таблицы БД                          |
|-----|-------------------------------------|-----------------------------------------------------|
| 1   | Клиент вводит критерии поиска       | —                                                   |
| 2   | Система ищет доступные номера       | `hotels`, `rooms`, `facilities`, `rooms_facilities` |
| 3   | Возврат списка доступных комнат     | —                                                   |
| 4   | Клиент выбирает комнату             | —                                                   |
| 5   | Клиент регистрируется/авторизуется  | `users`                                             |
| 6   | Работа с пользователем              | `users`                                             |
| 7   | Подтверждение бронирования и оплата | `bookings`                                          |
| 8   | Создание и обновление бронирования  | `bookings`                                          |

---

## Краткое описание таблиц, участвующих в процессе

- **`users`** — данные пользователей: id, email, хэш пароля, методы аутентификации (например, JWT).
- **`hotels`** — информация об отелях: id, название, местоположение.
- **`rooms`** — комнаты в отелях: id, ссылка на отель, название, описание, цена, количество мест.
- **`facilities`** — удобства (Wi-Fi, кондиционер и т.п.): id, наименование.
- **`rooms_facilities`** — связь многие-ко-многим между комнатами и удобствами.
- **`bookings`** — бронирования: id, ссылки на пользователя и комнату, даты, стоимость, статус бронирования (ожидает
  оплаты, оплачено, отменено), статус оплаты.

---

## Примеры API-запросов (кратко)

- Поиск комнат: `GET /rooms?date_from=YYYY-MM-DD&date_to=YYYY-MM-DD&facilities=wifi,ac`
- Регистрация пользователя: `POST /auth/register`
- Авторизация: `POST /auth/login`
- Создание бронирования: `POST /bookings`

---

## Тестирование

- Используются юнит-тесты и интеграционные тесты для проверки API и бизнес-логики.
- Тесты покрывают регистрацию, поиск, бронирование

---

## Безопасность и аутентификация

- Используется регистрация и авторизация пользователей с хранением хэшей паролей.
- Рекомендуется применять JWT для аутентификации и управления сессиями.

---

## Инфраструктура

- PostgreSQL — основная база данных.
- Redis — кэширование и брокер задач для Celery.
- Celery — обработка фоновых задач (например, отправка уведомлений).
- Docker — контейнеризация и деплой проекта.
- Swagger/OpenAPI — автоматическая документация API.

---

