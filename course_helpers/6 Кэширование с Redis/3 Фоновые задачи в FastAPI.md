# Фоновые задачи в FastAPI

## Фоновые задачи от FastAPI

FastAPI предоставляет нам возможность запускать задачи в фоновом режиме без использования Celery. Для этого достаточно в
эндпоинте принять аргумент с любым названием и типом `BackgroundTasks`:

```python
from fastapi import BackgroundTasks
from .. import EmailService


def send_cat_info(email: str, message=""):  # <-- отправляет информацию о котах на почту
    EmailService.send_email(email, message)


@app.post("/send_cat/{email}")  # <-- эндпоинт для отправки имейлов
async def send_cat(email: str, background_tasks: BackgroundTasks):
    background_tasks.add_task(send_cat_info, email, message="Пушистик, 1 месяц, рыжий")
    return {"message": "Сообщение о коте будет отправлено в фоновом режиме"}
```

FastAPI не будет забивать текущий поток отправкой письма, а создаст отдельный поток, в котором выполнит эту задачу (
правда если задача задействует мощность процессора, текущий поток будет заметно тормозить).
Celery имеет ряд преимуществ по сравнению с BackgroundTasks:

1. Выполнение задач в отдельном процессе
2. Сохранение результатов задач
3. Приоритизация задач
4. Повторение неудавшихся задач
5. Мониторинг исполнения задач через библиотеку Flower
6. Запуск регулярных задач (например, отправить отчет каждое утро в 9:00 всем руководителям)
