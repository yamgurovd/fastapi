# Миграции с Alembic

---

## Краткое содержание инструкции

В данной инструкции показан базовый процесс работы с миграциями базы данных с помощью Alembic — инструмента для
управления версиями схемы базы данных в проектах на Python с использованием SQLAlchemy.

### Что происходит в инструкции:

1. Устанавливаются необходимые пакеты sqlalchemy и alembic через pip.

2. Инициализируется Alembic в проекте командой alembic init migrations, которая создаёт структуру каталогов и
   конфигурационные файлы для миграций.

3. Создаётся новая миграция с помощью команды alembic revision --autogenerate -m "init". Флаг --autogenerate позволяет
   Alembic автоматически сгенерировать скрипт миграции, сравнив текущие модели SQLAlchemy с состоянием базы данных.

4. Применяется миграция к базе командой alembic upgrade head, что обновляет схему базы данных до последней версии
   миграции.

### Что происходит в целом

Таким образом, инструкция описывает стандартный цикл создания и применения миграций: установка, инициализация, генерация
миграции и её применение к базе данных. Это позволяет управлять изменениями структуры базы данных в контролируемом виде
и обеспечивает версионирование схемы

### Команды которые используется

| Команда                                     | Пояснение                                                                                                        |
|---------------------------------------------|------------------------------------------------------------------------------------------------------------------|
| `pip install sqlalchemy alembic`            | Установка необходимых пакетов SQLAlchemy и Alembic для работы с миграциями базы данных.                          |
| `alembic init migrations`                   | Инициализация Alembic в проекте, создание структуры каталогов и конфигурационных файлов для миграций.            |
| `alembic revision --autogenerate -m "init"` | Создание новой миграции с автоматической генерацией скрипта на основе текущих моделей SQLAlchemy и состояния БД. |
| `alembic upgrade head`                      | Применение миграции к базе данных, обновление схемы до последней версии миграции.                                |

# Подробная инструкция

---

### 1 Установка

```bash
pip install sqlalchemy alembic
```

### 2 Инициализация

```bash
alembic init migrations
```

### 3 Создание и применение миграции

```bash
alembic revision --autogenerate -m "init"
alembic upgrade head
```

![Пример миграций](/course_helpers/3%20База%20данных%20и%20паттерны/alembic_migrations_example1.png)

---